import sqlite3

def init_db():
    conn = sqlite3.connect("news.db")
    cursor = conn.cursor()
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS news (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            author TEXT,
            content TEXT,
            approved INTEGER DEFAULT 0,
            likes INTEGER DEFAULT 0
        )
    ''')
    cursor.execute('''
        CREATE TABLE IF NOT EXISTS comments (
            id INTEGER PRIMARY KEY AUTOINCREMENT,
            news_id INTEGER,
            content TEXT
        )
    ''')
    conn.commit()
    conn.close()

def add_news(author, content):
    conn = sqlite3.connect("news.db")
    cursor = conn.cursor()
    cursor.execute("INSERT INTO news (author, content) VALUES (?, ?)", (author, content))
    news_id = cursor.lastrowid
    conn.commit()
    conn.close()
    return news_id

def approve_news(news_id):
    conn = sqlite3.connect("news.db")
    cursor = conn.cursor()
    cursor.execute("UPDATE news SET approved = 1 WHERE id = ?", (news_id,))
    conn.commit()
    conn.close()

def reject_news(news_id):
    conn = sqlite3.connect("news.db")
    cursor = conn.cursor()
    cursor.execute("DELETE FROM news WHERE id = ?", (news_id,))
    conn.commit()
    conn.close()

def get_approved_news():
    conn = sqlite3.connect("news.db")
    cursor = conn.cursor()
    cursor.execute("SELECT * FROM news WHERE approved = 1 ORDER BY id DESC")
    data = cursor.fetchall()
    conn.close()
    return data

def add_comment(news_id, content):
    conn = sqlite3.connect("news.db")
    cursor = conn.cursor()
    cursor.execute("INSERT INTO comments (news_id, content) VALUES (?, ?)", (news_id, content))
    conn.commit()
    conn.close()

def get_comments(news_id):
    conn = sqlite3.connect("news.db")
    cursor = conn.cursor()
    cursor.execute("SELECT content FROM comments WHERE news_id = ?", (news_id,))
    comments = cursor.fetchall()
    conn.close()
    return comments

def like_news(news_id):
    conn = sqlite3.connect("news.db")
    cursor = conn.cursor()
    cursor.execute("UPDATE news SET likes = likes + 1 WHERE id = ?", (news_id,))
    conn.commit()
    conn.close()

def select_news():
    conn = sqlite3.connect("news.db")
    cursor = conn.cursor()
    s = cursor.execute("SELECT author, content FROM news").fetchall()
    conn.commit()
    conn.close()
    return s
